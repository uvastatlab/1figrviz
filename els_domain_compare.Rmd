---
title: "Elsevier by Domain: High Use, Current Year"
author: "UVA StatLab/RDS"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r setup}
library(tidyverse)
library(scales)
library(readxl)
library(gridExtra)

# read in 1figr tabs
journal <- read_excel("1science/1figr_U_Virginia_edit.xlsx", sheet = 4, skip = 8)

# rename variables in journal
names(journal) <- c("sort", "journal", "issn", "provider", "type", "fig1", "jr1", "jr5", "currentper",
                    "cites", "citeper", "pubs", "pubsper", "synth", "jtier", "subtier", "dupes",
                    "oa", "oaper", "fig2", "scopus", "arif", "domain", "field", "subfield", 
                    "pub2008", "pub2009", "pub2010", "pub2011", "pub2012", "pub2013", "pub2014",
                    "pub2015", "pub2016", "pub2017", "cite2008", "cite2009", "cite2010", "cite2011",
                    "cite2012", "cite2013", "cite2014", "cite2015", "cite2016", "cite2017", 
                    "oa2008", "oa2009", "oa2010", "oa2011", "oa2012", "oa2013", "oa2014", "oa2015", 
                    "oa2016", "oa2017", "oaper2008", "oaper2009", "oaper2010", "oaper2011", "oaper2012",
                    "oaper2013", "oaper2014", "oaper2015", "oaper2016", "oaper2017", "scopus2008",
                    "scopus2009", "scopus2010", "scopus2011", "scopus2012", "scopus2013", "scopus2014",
                    "scopus2015", "scopus2016", "scopus2017", "jr12015", "jr12016", "jr12017", "jr12018",
                    "jr12015_2018", "jid", "journalname")
```

The following figures replicate the prior analysis comapring the Big 5 providers, this time comparing across disciplinary domains within Elsevier alone.

## Percent of Journals Accounting for 80 Percent of Use

```{r prep}
# ELSEVIER BY FIELD
# ----------------------------------------------
# JR80 measures by field: Elsevier
# ----------------------------------------------
# jr1 2017 downloads: generate cumulative download sum and jr80 indicator
elsevier_jr80 <- journal %>% 
  select(journal, provider, type, jr1, jr5, cites, pubs, synth, scopus, domain, field, jid) %>% 
  filter(type == "Journal" & provider == "Elsevier") %>% 
  mutate(jr1 = as.integer(jr1), jr5 = as.integer(jr5)) %>% 
  group_by(domain) %>% 
  arrange(desc(jr1)) %>% 
  mutate(cum_jr1 = cumsum(jr1),
         prov_jr1 = max(cum_jr1, na.rm=T),
         cum_jr1_per = (cum_jr1/prov_jr1)*100,
         jr80_jr1 = if_else(cum_jr1_per <= 80, 1, 0)) %>% 
  arrange(desc(jr5)) %>% 
  mutate(cum_jr5 = cumsum(jr5),
         prov_jr5 = max(cum_jr5, na.rm=T),
         cum_jr5_per = (cum_jr5/prov_jr5)*100,
         jr80_jr5 = if_else(cum_jr5_per <= 80, 1, 0)) %>% 
  arrange(desc(cites)) %>% 
  mutate(cum_refs = cumsum(cites),
         prov_refs = max(cum_refs, na.rm=T),
         cum_refs_per = (cum_refs/prov_refs)*100,
         jr80_refs = if_else(cum_refs_per <= 80, 1, 0)) %>% 
  arrange(desc(pubs)) %>% 
  mutate(cum_pubs = cumsum(pubs),
         prov_pubs = max(cum_pubs, na.rm=T),
         cum_pubs_per = (cum_pubs/prov_pubs)*100,
         jr80_pubs = if_else(cum_pubs_per <= 80, 1, 0))

# grouped/summarized by domain
# generating all four JR80 measures  
elsevier_jr80_group <- elsevier_jr80 %>% 
  group_by(domain) %>% 
  summarize(titles = n(),
            titlesjr1 = sum(!is.na(jr1)),
            titlesjr5 = sum(!is.na(jr5)),
            jr80_jr1 = sum(jr80_jr1, na.rm=T),
            jr80_jr5 = sum(jr80_jr5, na.rm=T),
            jr80_refs = sum(jr80_refs, na.rm=T),
            jr80_pubs = sum(jr80_pubs, na.rm=T)) %>% 
  mutate(jr80_jr1per = (jr80_jr1/titles)*100,
         jr80_jr5per = (jr80_jr5/titles)*100,
         jr80_jrrefs = (jr80_refs/titles)*100,
         jr80_jrpubs = (jr80_pubs/titles)*100,
         title_jr1 = paste0( "(", jr80_jr1, "/", titlesjr1, ")" ),
         title_jr5 = paste0( "(", jr80_jr5, "/", titlesjr5, ")" ),
         title_refs = paste0( "(", jr80_refs, "/", titles, ")" ),
         title_pubs = paste0( "(", jr80_pubs, "/", titles, ")" ),
         domain = factor(domain)
  )
```

### All Elsevier downloads in 2017
```{r fig_download1}
# plot jr1 and jr5 top use by field
elsevier_jr80_group %>% mutate(domain = fct_reorder(domain, desc(jr80_jr1per))) %>% 
  ggplot(aes(x = domain, y = jr80_jr1per, color = domain)) + 
  geom_segment(aes(x = domain, xend = domain, y = 0, yend = jr80_jr1per), color = "grey", size = 1) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "BuPu", direction = -1) +
  labs(title = "80% Use Titles by Domain",
       subtitle = "All Articles (Top Titles / All Titles)",
       x = "", y = "Percent") +
  geom_text(aes(label = title_jr1), nudge_x = -.25, color = "black", size = 3) +
  expand_limits(y = max(elsevier_jr80_group$jr80_jr1per)+2) +
  theme(legend.position = "none") +
  coord_flip() 
```

### 2017 Elsevier downloads in 2017
```{r fig_download2}
elsevier_jr80_group %>% mutate(domain = fct_reorder(domain, desc(jr80_jr5per))) %>% 
  ggplot(aes(x = domain, y = jr80_jr5per, color = domain)) + 
  geom_segment(aes(x = domain, xend = domain, y = 0, yend = jr80_jr5per), color = "grey", size = 1) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "BuPu", direction = -1) +
  labs(title = "80% Use Titles by Domain",
       subtitle = "2017 Articles (Top Titles / All Titles)",
       x = "", y = "Percent") +
  geom_text(aes(label = title_jr5), nudge_x = -.25, color = "black", size = 3) +
  expand_limits(y = max(elsevier_jr80_group$jr80_jr5per)+2) +
  theme(legend.position = "none") +
  coord_flip() 
```

### UVA Referneces to Elsevier Material 2008-2017
```{r ref_fig}
# plot refs and pubs top use by field
elsevier_jr80_group %>% mutate(domain = fct_reorder(domain, desc(jr80_jrrefs))) %>% 
  ggplot(aes(x = domain, y = jr80_jrrefs, color = domain)) + 
  geom_segment(aes(x = domain, xend = domain, y = 0, yend = jr80_jrrefs), color = "grey", size = 1) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "BuPu", direction = -1) +
  labs(title = "80% Use Titles by Domain",
       subtitle = "References (Top Titles / All Titles)",
       x = "", y = "Percent") +
  geom_text(aes(label = title_refs), nudge_x = -.25, color = "black", size = 3) +
  expand_limits(y = max(elsevier_jr80_group$jr80_jrrefs)+2) +
  theme(legend.position = "none") +
  coord_flip() 
```

### UVA-Authored Publications in Elsevier 2008-2017
```{r pub_fig}
elsevier_jr80_group %>% mutate(domain = fct_reorder(domain, desc(jr80_jrpubs))) %>% 
  ggplot(aes(x = domain, y = jr80_jrpubs, color = domain)) + 
  geom_segment(aes(x = domain, xend = domain, y = 0, yend = jr80_jrpubs), color = "grey", size = 1) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "BuPu", direction = -1) +
  labs(title = "80% Use Titles by Domain",
       subtitle = "Publications (Top Titles / All Titles)",
       x = "", y = "Percent") +
  geom_text(aes(label = title_pubs), nudge_x = -.25, color = "black", size = 3) +
  expand_limits(y = max(elsevier_jr80_group$jr80_jrpubs)+2) +
  theme(legend.position = "none") +
  coord_flip() 
```

## Percent of Current Year Elsevier Downloads
```{r ratio_fig}
# ELSEVIER JR5/JR1 ratio by field
# ----------------------------------------------
# grouped/summarized by domain
elsevier_jr5 <- journal %>% 
  select(journal, provider, type, jr1, jr5, cites, pubs, synth, scopus, domain, field, jid) %>% 
  filter(type == "Journal" & provider == "Elsevier") %>% 
  mutate(jr1 = as.integer(jr1),
         jr5 = as.integer(jr5)) %>% 
  group_by(domain) %>% 
  summarize(jr1 = sum(jr1, na.rm=T),
            jr5 = sum(jr5, na.rm=T)) %>% 
  mutate(jr5per = (jr5/jr1)*100)


# JR5 ratio for by field
elsevier_jr5 %>% mutate(domain = fct_reorder(domain, desc(jr5per))) %>% 
  ggplot(aes(x = domain, y = jr5per, color = domain)) + 
  geom_segment(aes(x = domain, xend = domain, y = 0, yend = jr5per), color = "grey", size = 1) +
  geom_point(size = 5) +
  scale_color_brewer(palette = "BuPu", direction = -1) +
  labs(title = "Percent of Articles Downloaded in 2017 from Current Year",
       subtitle = "By Domain",
       x = "", y = "Percent") +
  theme(legend.position = "none") +
  coord_flip() 
```

### Current Year Use among High-Use Journals

```{r}
# JR5/CURRENT YEAR USE AMONG HIGH-USE JOURNALS ----
# ----------------------------------------------
# add the jr5 ratio to jr80 measures for comparison
elsevier_jr80 <- elsevier_jr80 %>% 
  mutate(jr5per = (jr5/jr1)*100,
         jr80_jr5f = factor(jr80_jr5, levels = c(1, 0), labels = c("Yes", "No")))

# density plot
elsevier_jr80 %>% 
  ggplot(aes(x = jr5per, fill = jr80_jr5f)) + 
  geom_density(alpha = 1/5) +
  scale_fill_manual(values = c("orange", "blue")) +
  facet_wrap(~domain, scales = "free") +
  labs(title = "Distribution of Percent Current Year Downloads: Elsevier",
       subtitle = "By Domain and High-Use Designation",
       x = "Percent Current Year Downloads", 
       y = "Proportion of Journals at Each Value",
       fill = "High-Use") 
```